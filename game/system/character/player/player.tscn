[gd_scene format=3 uid="uid://dvu82xeeb87ff"]

[ext_resource type="PackedScene" uid="uid://cqk4twm4sfdyp" path="res://game/system/character/Character.tscn" id="1_obar5"]
[ext_resource type="Script" uid="uid://cmbivobrytkx7" path="res://game/system/character/player/player.gd" id="2_b2mth"]
[ext_resource type="PackedScene" uid="uid://cc5iuju00imms" path="res://game/system/anatomy/parts/body/player_arm.tscn" id="3_3ipx8"]
[ext_resource type="Texture2D" uid="uid://0e11br4awprf" path="res://sprites/body_parts/Basehead/BaseHead.png" id="3_jme82"]
[ext_resource type="Texture2D" uid="uid://c7hpvptgk40bi" path="res://sprites/body_parts/Noise.png" id="5_0fnm0"]
[ext_resource type="Texture2D" uid="uid://btk5wola3ox5u" path="res://sprites/body_parts/Shadows/Shadows.png" id="5_alke5"]
[ext_resource type="Texture2D" uid="uid://dq5dyeefodkfo" path="res://sprites/body_parts/FaceAssets/Beard.png" id="6_w1s3x"]
[ext_resource type="Texture2D" uid="uid://cv1u60umjpb1l" path="res://sprites/body_parts/FaceAssets/Beard2.png" id="7_388rn"]
[ext_resource type="Texture2D" uid="uid://w4hkk7bw5m48" path="res://sprites/body_parts/FaceAssets/Nose.png" id="7_ka5xu"]
[ext_resource type="Texture2D" uid="uid://b2ckq0bnxkhvc" path="res://sprites/body_parts/FaceAssets/Eye.png" id="8_388rn"]
[ext_resource type="Texture2D" uid="uid://b8hrd4p7oqxrv" path="res://sprites/body_parts/FaceAssets/Beard4.png" id="8_eq501"]
[ext_resource type="Texture2D" uid="uid://dgfbrc3ii8iw6" path="res://sprites/body_parts/FaceAssets/Ear1.png" id="9_eq501"]
[ext_resource type="Texture2D" uid="uid://b3w53qi4iph3g" path="res://sprites/body_parts/FaceAssets/Ear2.png" id="10_hu301"]
[ext_resource type="Texture2D" uid="uid://d1r4bn32e30v7" path="res://sprites/body_parts/FaceAssets/MouthPainExp.png" id="11_f2h07"]
[ext_resource type="Texture2D" uid="uid://defn8lxlh0cq7" path="res://sprites/body_parts/Bodies/MCbody.png" id="12_f2h07"]

[sub_resource type="Shader" id="Shader_2ro5p"]
code = "shader_type canvas_item;

uniform sampler2D sprite_texture : source_color, filter_linear;

uniform vec4 line_color : source_color = vec4(1.0, 1.0, 1.0, 1.0);
uniform float glowSize : hint_range(0.0, 300.0) = 15.0;
uniform int glowDensity : hint_range(0, 30) = 3;
uniform int glowRadialCoverage : hint_range(0, 32) = 4;
uniform float glowAngle : hint_range(0.0, 6.283) = 1.57;
uniform float glowSharpness : hint_range(0.0, 5.0) = 1.0;
uniform float alphaThreshold : hint_range(0.0, 1.0) = 0.2;

void fragment() {
	vec4 col = texture(sprite_texture, UV);

	COLOR = col;

	vec2 pixel_size = 1.0 / vec2(textureSize(sprite_texture, 0));
	float alph = 0.0;

	for (int i = 0; i < glowRadialCoverage; i++) {
		for (int j = 0; j < glowDensity; j++) {
			float angle = (TAU / float(glowRadialCoverage)) * float(i + 1) + glowAngle;
			float dist = glowSize * float(j + 1) / float(glowDensity);

			vec2 offset = vec2(sin(angle), cos(angle)) * pixel_size * dist;
			vec4 tex = texture(sprite_texture, UV + offset);

			float distFrom = float(glowDensity - j) / float(glowDensity);
			float sharpness = pow(distFrom, glowSharpness);

			alph += tex.a * line_color.a * sharpness;
		}
	}

	if (col.a < alphaThreshold) {
		COLOR.rgb = line_color.rgb;
		COLOR.a = alph;
	}
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_eq501"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("8_388rn")
shader_parameter/line_color = Color(0.38431373, 0.6862745, 0.827451, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 1.0510000499225
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_8xspq"]
size = Vector2(30.499966, 19.50006)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_hu301"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("8_388rn")
shader_parameter/line_color = Color(0.38431373, 0.6862745, 0.827451, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 1.4530000690175
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_f2h07"]
size = Vector2(34.164482, 18.00142)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_wqm0g"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("9_eq501")
shader_parameter/line_color = Color(0.12188911, 0.29515338, 0.3726175, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 1.0070000478325
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hu301"]
size = Vector2(21.977163, 54.117477)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_xvqmr"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("10_hu301")
shader_parameter/line_color = Color(0.11427725, 0.28049052, 0.35477668, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 0.79600003781
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_wqm0g"]
size = Vector2(21.978048, 55.090958)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_ltwwj"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("7_ka5xu")
shader_parameter/line_color = Color(0.38431373, 0.6862745, 0.827451, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 1.6430000780425
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_388rn"]
size = Vector2(25, 69)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_0eq7q"]
shader = SubResource("Shader_2ro5p")
shader_parameter/sprite_texture = ExtResource("11_f2h07")
shader_parameter/line_color = Color(0.38431373, 0.6862745, 0.827451, 1)
shader_parameter/glowSize = 4.00000019
shader_parameter/glowDensity = 30
shader_parameter/glowRadialCoverage = 32
shader_parameter/glowAngle = 1.57
shader_parameter/glowSharpness = 2.2400001064
shader_parameter/alphaThreshold = 0.2

[sub_resource type="RectangleShape2D" id="RectangleShape2D_eq501"]
size = Vector2(70, 27)

[node name="Player" unique_id=1861387119 node_paths=PackedStringArray("arm") instance=ExtResource("1_obar5")]
script = ExtResource("2_b2mth")
critical_chance = 0.3
top_down_dir = -1
action_cooldown = 1.0
arm = NodePath("ArmR")

[node name="Face" parent="." index="0" unique_id=1276534686]
self_modulate = Color(0.84745413, 0.6991107, 0.7562015, 1)
z_index = 1
rotation = 3.1415927
texture = ExtResource("3_jme82")

[node name="Noise" type="Sprite2D" parent="Face" index="0" unique_id=290120544]
modulate = Color(1, 1, 1, 0.7372549)
z_index = 5
texture_filter = 1
position = Vector2(-2.0000002, -2.9999998)
rotation = -0.053846277
texture = ExtResource("5_0fnm0")

[node name="Shadow" type="Sprite2D" parent="Face" index="1" unique_id=1034765696]
texture_filter = 1
position = Vector2(3.999999, -12.000001)
rotation = 0.087266445
scale = Vector2(1.1, 1.1)
texture = ExtResource("5_alke5")

[node name="Beard1" type="Sprite2D" parent="Face" index="2" unique_id=1900917381]
z_index = 5
position = Vector2(-3.9999993, 8)
texture = ExtResource("6_w1s3x")

[node name="Beard2" type="Sprite2D" parent="Face" index="3" unique_id=396302187]
z_index = 5
position = Vector2(1.0000017, 20)
texture = ExtResource("7_388rn")

[node name="Beard3" type="Sprite2D" parent="Face" index="4" unique_id=1251884929]
z_index = 5
position = Vector2(-0.99999833, 19)
texture = ExtResource("8_eq501")

[node name="EyeL" parent="Face/Features" parent_id_path=PackedInt32Array(2130456873) index="0" unique_id=1690948451]
position = Vector2(16.999996, -35)

[node name="Sprite" parent="Face/Features/EyeL" index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_eq501")
position = Vector2(48.19999, 48.999985)
scale = Vector2(1.2, 1.2)
texture = ExtResource("8_388rn")

[node name="MouseDetectArea" parent="Face/Features/EyeL" index="1" unique_id=1106976729]
position = Vector2(10.949966, 16.24997)

[node name="CollisionShape2D" parent="Face/Features/EyeL/MouseDetectArea" index="0" unique_id=149295176]
position = Vector2(1.5, -2.000002)
shape = SubResource("RectangleShape2D_8xspq")

[node name="EyeR" parent="Face/Features" parent_id_path=PackedInt32Array(2130456873) index="1" unique_id=584210078]
position = Vector2(-22.000002, -19.999998)
rotation = -0.07759997

[node name="Sprite" parent="Face/Features/EyeR" index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_hu301")
position = Vector2(-44.86579, 33.95976)
scale = Vector2(1.2, 1.2)
texture = ExtResource("8_388rn")

[node name="MouseDetectArea" parent="Face/Features/EyeR" index="1" unique_id=1106976729]
position = Vector2(-8.002902, -0.5239539)

[node name="CollisionShape2D" parent="Face/Features/EyeR/MouseDetectArea" index="0" unique_id=149295176]
position = Vector2(-0.8089905, -1.1648483)
rotation = 0.07903791
scale = Vector2(1.0000004, 1.0000004)
shape = SubResource("RectangleShape2D_f2h07")

[node name="EarL" parent="Face/Features" parent_id_path=PackedInt32Array(2130456873) index="2" unique_id=1222327045]
position = Vector2(51.99999, -10.000007)
rotation = -0.15569358

[node name="Sprite" parent="Face/Features/EarL" index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_wqm0g")
position = Vector2(10.113709, -2.5014496)
scale = Vector2(1.3, 1.3)
texture = ExtResource("9_eq501")
flip_h = false

[node name="MouseDetectArea" parent="Face/Features/EarL" index="1" unique_id=1106976729]
position = Vector2(8.108372, 33.664528)

[node name="CollisionShape2D" parent="Face/Features/EarL/MouseDetectArea" index="0" unique_id=149295176]
position = Vector2(1.930275, -33.142742)
rotation = 0.11014061
scale = Vector2(1.0000002, 1.0000002)
shape = SubResource("RectangleShape2D_hu301")

[node name="EarR" parent="Face/Features" parent_id_path=PackedInt32Array(2130456873) index="3" unique_id=959483894]
position = Vector2(-39, 2.0000036)
rotation = 0.093511336

[node name="Sprite" parent="Face/Features/EarR" index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_xvqmr")
position = Vector2(-24.469463, 2.1380062)
scale = Vector2(1.3, 1.3)
texture = ExtResource("10_hu301")

[node name="MouseDetectArea" parent="Face/Features/EarR" index="1" unique_id=1106976729]
position = Vector2(-29.469452, 31.13801)

[node name="CollisionShape2D" parent="Face/Features/EarR/MouseDetectArea" index="0" unique_id=149295176]
position = Vector2(5.8763695, -26.400906)
rotation = -0.13820246
scale = Vector2(1.0000002, 1.0000002)
shape = SubResource("RectangleShape2D_wqm0g")

[node name="Sprite" parent="Face/Features/Nose" parent_id_path=PackedInt32Array(1350482542) index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_ltwwj")
texture = ExtResource("7_ka5xu")

[node name="CollisionShape2D" parent="Face/Features/Nose/MouseDetectArea" parent_id_path=PackedInt32Array(1350482542, 1106976729) index="0" unique_id=149295176]
position = Vector2(-0.5000001, 0.5)
shape = SubResource("RectangleShape2D_388rn")

[node name="Mouth" parent="Face/Features" parent_id_path=PackedInt32Array(2130456873) index="5" unique_id=508432269]
position = Vector2(-0.9999968, 37)

[node name="Sprite" parent="Face/Features/Mouth" index="0" unique_id=500964707]
material = SubResource("ShaderMaterial_0eq7q")
position = Vector2(-1.000001, 3)
scale = Vector2(1.5, 1.5)
texture = ExtResource("11_f2h07")

[node name="CollisionShape2D" parent="Face/Features/Mouth/MouseDetectArea" parent_id_path=PackedInt32Array(508432269, 1106976729) index="0" unique_id=149295176]
position = Vector2(-1.0000001, 6.5)
shape = SubResource("RectangleShape2D_eq501")

[node name="Shoulder" type="Sprite2D" parent="." index="1" unique_id=779808539]
z_index = -3
texture_filter = 1
rotation = -3.054326
scale = Vector2(0.5, 0.5)
texture = ExtResource("12_f2h07")

[node name="ArmR" parent="." index="2" unique_id=334395171 instance=ExtResource("3_3ipx8")]
unique_name_in_owner = true
z_index = 2
position = Vector2(103, -23)

[node name="MarginContainer" parent="CombatComponent/CanvasLayer" parent_id_path=PackedInt32Array(823960288, 296824878) index="0" unique_id=1187610258]
theme_override_constants/margin_right = 230

[editable path="Face/Features/EyeL"]
[editable path="Face/Features/EyeR"]
[editable path="Face/Features/EarL"]
[editable path="Face/Features/EarR"]
[editable path="Face/Features/Nose"]
[editable path="Face/Features/Mouth"]
[editable path="CombatComponent"]
